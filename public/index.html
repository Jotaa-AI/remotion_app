<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smart Overlay Studio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <style>
      :root {
        --bg: #eef3ff;
        --surface: #ffffff;
        --surface-soft: #f5f8ff;
        --line: #d9e4ff;
        --line-strong: #bdd0ff;
        --text: #0f172a;
        --muted: #64748b;
        --brand: #2551ff;
        --brand-2: #24b9ff;
        --success: #0f8a4c;
        --danger: #d14343;
        --warning: #b45309;
        --shadow: 0 22px 52px rgba(37, 81, 255, 0.12);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Space Grotesk", "Avenir Next", sans-serif;
        color: var(--text);
        background:
          radial-gradient(circle at 12% 8%, rgba(37, 81, 255, 0.2) 0, transparent 34%),
          radial-gradient(circle at 88% 16%, rgba(36, 185, 255, 0.22) 0, transparent 32%),
          linear-gradient(180deg, #f7f9ff 0%, #edf3ff 100%);
      }

      .page {
        width: min(1280px, 100%);
        margin: 0 auto;
        padding: 18px;
      }

      .topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        border: 1px solid rgba(255, 255, 255, 0.9);
        border-radius: 18px;
        padding: 10px 14px;
        background: rgba(255, 255, 255, 0.78);
        box-shadow: var(--shadow);
        backdrop-filter: blur(8px);
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .brand-badge {
        width: 32px;
        height: 32px;
        border-radius: 10px;
        display: grid;
        place-items: center;
        font-size: 17px;
        font-weight: 800;
        color: #fff;
        background: linear-gradient(135deg, var(--brand), var(--brand-2));
      }

      .brand-name {
        font-size: 15px;
        font-weight: 800;
      }

      .brand-sub {
        font-size: 11px;
        color: var(--muted);
      }

      .hero-title {
        margin: 14px 0 0;
        font-size: clamp(30px, 4.1vw, 45px);
        line-height: 0.98;
        letter-spacing: -0.5px;
      }

      .hero-sub {
        margin: 10px 0 0;
        max-width: 920px;
        color: #334155;
        font-size: 14px;
        line-height: 1.45;
      }

      .process-map-shell {
        margin-top: 14px;
        border: 1px solid var(--line);
        border-radius: 20px;
        background: linear-gradient(165deg, rgba(255, 255, 255, 0.96) 0%, rgba(245, 250, 255, 0.96) 100%);
        box-shadow: var(--shadow);
        overflow: hidden;
      }

      .process-map-head {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        border-bottom: 1px solid var(--line);
        padding: 14px 16px;
      }

      .process-map-head h2 {
        margin: 0;
        font-size: 17px;
        font-weight: 780;
      }

      .process-map-head p {
        margin: 4px 0 0;
        color: var(--muted);
        font-size: 12px;
      }

      .global-progress-pill {
        border: 1px solid var(--line-strong);
        border-radius: 999px;
        padding: 6px 11px;
        background: #fff;
        font-size: 11px;
        font-weight: 700;
        color: #1e3a8a;
      }

      .process-map-grid {
        display: grid;
        grid-template-columns: minmax(640px, 1.4fr) minmax(300px, 0.6fr);
        gap: 12px;
        padding: 12px;
      }

      .process-map-canvas {
        border: 1px solid var(--line);
        border-radius: 16px;
        background: #fff;
        padding: 12px;
        position: relative;
      }

      .pipeline-svg {
        width: 100%;
        height: 280px;
        display: block;
      }

      .thread-base {
        fill: none;
        stroke: #d9e5ff;
        stroke-width: 6;
        stroke-linecap: round;
      }

      .thread-progress {
        fill: none;
        stroke: url(#threadProgressGradient);
        stroke-width: 6;
        stroke-linecap: round;
        transition: stroke-dashoffset 0.5s ease;
      }

      .thread-pulse {
        filter: drop-shadow(0 0 8px rgba(37, 81, 255, 0.5));
        animation: pulseBeat 1.2s ease-in-out infinite;
      }

      @keyframes pulseBeat {
        0% {
          transform: scale(1);
          opacity: 0.95;
        }
        50% {
          transform: scale(1.2);
          opacity: 0.75;
        }
        100% {
          transform: scale(1);
          opacity: 0.95;
        }
      }

      .thread-node {
        cursor: pointer;
      }

      .thread-node-circle {
        stroke-width: 2;
        transition: fill 0.2s ease, stroke 0.2s ease, transform 0.2s ease;
      }

      .thread-node-label {
        font-size: 11px;
        font-weight: 650;
        text-anchor: middle;
        fill: #334155;
        pointer-events: none;
      }

      .thread-node-number {
        font-size: 10px;
        font-weight: 800;
        text-anchor: middle;
        dominant-baseline: middle;
        pointer-events: none;
      }

      .thread-node.pending .thread-node-circle {
        fill: #f8faff;
        stroke: #c9d7ff;
      }

      .thread-node.pending .thread-node-number {
        fill: #64748b;
      }

      .thread-node.active .thread-node-circle {
        fill: #dbeafe;
        stroke: #1d4ed8;
      }

      .thread-node.active .thread-node-number {
        fill: #1d4ed8;
      }

      .thread-node.waiting .thread-node-circle {
        fill: #fef3c7;
        stroke: #b45309;
      }

      .thread-node.waiting .thread-node-number {
        fill: #92400e;
      }

      .thread-node.completed .thread-node-circle {
        fill: #dcfce7;
        stroke: #15803d;
      }

      .thread-node.completed .thread-node-number {
        fill: #166534;
      }

      .thread-node.failed .thread-node-circle {
        fill: #fee2e2;
        stroke: #dc2626;
      }

      .thread-node.failed .thread-node-number {
        fill: #991b1b;
      }

      .thread-node.omitted .thread-node-circle {
        fill: #f1f5f9;
        stroke: #94a3b8;
        stroke-dasharray: 4 2;
      }

      .thread-node.omitted .thread-node-number {
        fill: #64748b;
      }

      .thread-node.selected .thread-node-circle {
        stroke-width: 3;
        transform: scale(1.05);
      }

      .process-map-mobile {
        display: none;
      }

      .mobile-timeline {
        position: relative;
        padding-left: 38px;
      }

      .mobile-timeline-rail {
        position: absolute;
        left: 15px;
        top: 10px;
        bottom: 10px;
        width: 4px;
        border-radius: 999px;
        background: #d9e5ff;
      }

      .mobile-timeline-fill {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        border-radius: inherit;
        background: linear-gradient(180deg, #24b9ff 0%, #2551ff 100%);
        height: 0%;
        transition: height 0.45s ease;
      }

      .mobile-timeline-pulse {
        position: absolute;
        left: 50%;
        top: 0%;
        transform: translate(-50%, -50%);
        width: 12px;
        height: 12px;
        border-radius: 999px;
        background: #2551ff;
        box-shadow: 0 0 0 5px rgba(37, 81, 255, 0.15);
        transition: top 0.45s ease;
      }

      .mobile-phase-list {
        margin: 0;
        padding: 0;
        list-style: none;
        display: grid;
        gap: 10px;
      }

      .mobile-phase-item {
        border: 1px solid var(--line);
        border-radius: 12px;
        padding: 10px;
        background: #fff;
        cursor: pointer;
      }

      .mobile-phase-item-title {
        font-size: 13px;
        font-weight: 700;
      }

      .mobile-phase-item-state {
        margin-top: 4px;
        font-size: 11px;
        color: var(--muted);
      }

      .mobile-phase-item.active {
        border-color: #8ea7ff;
        background: #f2f6ff;
      }

      .mobile-phase-item.waiting {
        border-color: #f1c36d;
      }

      .mobile-phase-item.completed {
        border-color: #86d7ac;
      }

      .mobile-phase-item.failed {
        border-color: #f3a0a0;
      }

      .mobile-phase-item.omitted {
        border-style: dashed;
      }

      .process-map-detail {
        border: 1px solid var(--line);
        border-radius: 16px;
        background: #fff;
        padding: 12px;
        display: grid;
        gap: 10px;
        align-content: start;
      }

      .phase-chip {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        width: fit-content;
        border-radius: 999px;
        padding: 5px 10px;
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.2px;
      }

      .phase-chip.pending {
        background: #e2e8f0;
        color: #475569;
      }

      .phase-chip.active {
        background: #dbeafe;
        color: #1d4ed8;
      }

      .phase-chip.waiting {
        background: #fef3c7;
        color: #92400e;
      }

      .phase-chip.completed {
        background: #dcfce7;
        color: #166534;
      }

      .phase-chip.failed {
        background: #fee2e2;
        color: #991b1b;
      }

      .phase-chip.omitted {
        background: #f1f5f9;
        color: #64748b;
      }

      .phase-step {
        color: var(--muted);
        font-size: 12px;
        font-weight: 600;
      }

      .phase-title {
        margin: 0;
        font-size: 22px;
        line-height: 1;
      }

      .phase-summary {
        margin: 0;
        color: #334155;
        font-size: 13px;
        line-height: 1.45;
      }

      .phase-action {
        border-radius: 12px;
        border: 1px solid var(--line);
        background: var(--surface-soft);
        padding: 10px;
        font-size: 12px;
        color: #1e293b;
      }

      .detail-grid {
        display: grid;
        gap: 8px;
      }

      .detail-item {
        border: 1px solid var(--line);
        border-radius: 10px;
        padding: 8px;
        background: #fff;
      }

      .detail-label {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.4px;
        color: #64748b;
        font-weight: 700;
      }

      .detail-value {
        margin-top: 2px;
        font-size: 12px;
        color: #0f172a;
      }

      .mini-progress {
        height: 9px;
        border-radius: 999px;
        border: 1px solid var(--line-strong);
        background: #e7eeff;
        overflow: hidden;
      }

      .mini-progress-bar {
        width: 0;
        height: 100%;
        border-radius: inherit;
        background: linear-gradient(90deg, #2551ff 0%, #24b9ff 100%);
        transition: width 0.4s ease;
      }

      .mini-progress-text {
        margin-top: 4px;
        font-size: 11px;
        color: #475569;
      }

      .inline-note {
        margin: 0;
        font-size: 12px;
      }

      .inline-note.warning {
        color: var(--warning);
      }

      .inline-note.error {
        color: var(--danger);
      }

      .workspace {
        margin-top: 14px;
        display: grid;
        grid-template-columns: minmax(340px, 0.85fr) minmax(500px, 1.15fr);
        gap: 14px;
      }

      .stack {
        display: grid;
        gap: 12px;
      }

      .panel {
        border: 1px solid var(--line);
        border-radius: 16px;
        background: rgba(255, 255, 255, 0.96);
        box-shadow: var(--shadow);
        padding: 14px;
      }

      .panel-title {
        margin: 0;
        font-size: 16px;
        font-weight: 760;
      }

      .panel-sub {
        margin: 6px 0 0;
        color: var(--muted);
        font-size: 12px;
      }

      label {
        display: block;
        margin-top: 10px;
        margin-bottom: 5px;
        font-size: 12px;
        font-weight: 650;
        color: #1e293b;
      }

      input[type="file"],
      input[type="url"],
      input[type="text"],
      input[type="number"],
      select,
      textarea,
      button {
        width: 100%;
        font-family: inherit;
      }

      input[type="file"],
      input[type="url"],
      input[type="text"],
      input[type="number"],
      select,
      textarea {
        border: 1px solid var(--line-strong);
        border-radius: 11px;
        background: var(--surface-soft);
        color: var(--text);
        font-size: 14px;
        padding: 10px 11px;
      }

      textarea {
        min-height: 106px;
        resize: vertical;
      }

      button {
        border: none;
        border-radius: 11px;
        padding: 10px 12px;
        font-size: 14px;
        font-weight: 760;
        cursor: pointer;
        color: #fff;
        background: linear-gradient(130deg, var(--brand) 0%, #4e75ff 45%, var(--brand-2) 100%);
      }

      button.secondary {
        background: linear-gradient(130deg, #0f172a 0%, #1e3a8a 100%);
      }

      button.ghost {
        border: 1px solid var(--line-strong);
        background: #fff;
        color: #1e3a8a;
      }

      button:disabled {
        opacity: 0.7;
        cursor: progress;
      }

      .caption {
        margin-top: 8px;
        font-size: 12px;
        color: var(--muted);
      }

      .codebox {
        margin: 0;
        border-radius: 11px;
        border: 1px solid #1e293b;
        background: #0f172a;
        color: #e2e8f0;
        font-size: 12px;
        line-height: 1.4;
        padding: 12px;
        white-space: pre-wrap;
        word-break: break-word;
      }

      .download-link {
        color: #1d4ed8;
        font-weight: 700;
        font-size: 13px;
      }

      video {
        width: 100%;
        margin-top: 8px;
        border-radius: 11px;
        border: 1px solid var(--line);
        background: #000;
      }

      .insights-list {
        display: grid;
        gap: 10px;
      }

      .insight-card {
        border: 1px solid var(--line);
        border-radius: 13px;
        background: linear-gradient(160deg, #f9fbff 0%, #f3f7ff 100%);
        padding: 10px;
      }

      .insight-time {
        display: inline-flex;
        align-items: center;
        border: 1px solid var(--line-strong);
        border-radius: 999px;
        background: #fff;
        padding: 3px 8px;
        font-size: 11px;
        font-weight: 700;
        color: #1d4ed8;
      }

      .insight-topic {
        margin: 6px 0 0;
        font-size: 14px;
        font-weight: 780;
      }

      .insight-text {
        margin: 6px 0 0;
        font-size: 12px;
        line-height: 1.45;
        color: #334155;
      }

      .insight-impact,
      .insight-anim {
        margin-top: 6px;
        border-left: 3px solid #3b82f6;
        padding-left: 7px;
        font-size: 12px;
        color: #0f172a;
      }

      .visual-editor {
        margin-top: 10px;
        display: grid;
        gap: 10px;
      }

      .overlay-card {
        border: 1px solid var(--line);
        border-radius: 13px;
        padding: 10px;
        background: linear-gradient(160deg, #f7f9ff 0%, #f1f5ff 100%);
      }

      .overlay-head {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        margin-bottom: 8px;
      }

      .overlay-head-left {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .overlay-toggle {
        width: auto;
      }

      .overlay-title {
        font-size: 13px;
        font-weight: 760;
      }

      .overlay-time {
        font-size: 11px;
        color: var(--muted);
      }

      .overlay-context {
        margin: 0 0 8px;
        padding-left: 7px;
        border-left: 3px solid #93c5fd;
        font-size: 11px;
        line-height: 1.35;
        color: #334155;
      }

      .overlay-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 8px;
      }

      .overlay-field label {
        margin: 0 0 4px;
        font-size: 11px;
        color: var(--muted);
      }

      .overlay-field input[type="color"] {
        border: 1px solid var(--line-strong);
        border-radius: 9px;
        padding: 2px;
        height: 38px;
        background: #fff;
      }

      .effects-wrap {
        margin-top: 8px;
        border: 1px dashed var(--line-strong);
        border-radius: 10px;
        padding: 8px;
        background: #fff;
      }

      .effects-list {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 6px;
      }

      .effect-chip {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 11px;
        color: #334155;
      }

      .effect-chip input {
        width: auto;
      }

      .inline-actions {
        display: flex;
        gap: 8px;
      }

      .chat-log {
        margin-top: 10px;
        max-height: 220px;
        overflow-y: auto;
        display: grid;
        gap: 6px;
        border: 1px solid var(--line);
        border-radius: 11px;
        background: #f8faff;
        padding: 8px;
      }

      .chat-item {
        border: 1px solid var(--line);
        border-radius: 9px;
        padding: 8px;
        font-size: 12px;
        line-height: 1.35;
      }

      .chat-item.user {
        background: #e8eeff;
      }

      .chat-item.assistant {
        background: #ecf8ff;
      }

      .actions-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }

      .section-anchor {
        scroll-margin-top: 20px;
      }

      @media (max-width: 1140px) {
        .process-map-grid {
          grid-template-columns: 1fr;
        }

        .workspace {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 760px) {
        .page {
          padding: 12px;
        }

        .topbar {
          border-radius: 14px;
        }

        .hero-title {
          font-size: 30px;
        }

        .pipeline-svg {
          display: none;
        }

        .process-map-mobile {
          display: block;
        }

        .overlay-grid,
        .effects-list,
        .actions-row {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <main class="page">
      <header class="topbar">
        <div class="brand">
          <div class="brand-badge">S</div>
          <div>
            <div class="brand-name">Smart Overlay Studio</div>
            <div class="brand-sub">AI Motion Layering</div>
          </div>
        </div>
      </header>

      <h1 class="hero-title">Mapa completo del pipeline visual</h1>
      <p class="hero-sub">
        Sigue cada fase desde la entrada del video hasta el resultado final. El hilo de progreso avanza en tiempo real y te muestra
        exactamente qué está haciendo el sistema en cada momento.
      </p>

      <section class="process-map-shell" id="process-map-shell">
        <div class="process-map-head">
          <div>
            <h2>Pipeline End-to-End</h2>
            <p>11 fases conectadas, detalle interactivo y progreso sobre el hilo.</p>
          </div>
          <div id="pipeline-global-progress" class="global-progress-pill">0% completado</div>
        </div>

        <div class="process-map-grid">
          <article class="process-map-canvas">
            <svg id="pipeline-svg" class="pipeline-svg" viewBox="0 0 1240 280" aria-label="Diagrama del pipeline">
              <defs>
                <linearGradient id="threadProgressGradient" x1="0" y1="0" x2="1" y2="0">
                  <stop offset="0%" stop-color="#24b9ff" />
                  <stop offset="50%" stop-color="#2551ff" />
                  <stop offset="100%" stop-color="#2551ff" />
                </linearGradient>
              </defs>
              <path id="pipeline-path-base" class="thread-base" d="" />
              <path id="pipeline-path-progress" class="thread-progress" d="" />
              <circle id="pipeline-pulse" class="thread-pulse" cx="0" cy="0" r="7" fill="#2551ff" />
              <g id="pipeline-nodes"></g>
            </svg>

            <div class="process-map-mobile" id="process-map-mobile">
              <div class="mobile-timeline">
                <div class="mobile-timeline-rail">
                  <div id="pipeline-mobile-fill" class="mobile-timeline-fill"></div>
                  <div id="pipeline-mobile-pulse" class="mobile-timeline-pulse"></div>
                </div>
                <ul id="pipeline-mobile-list" class="mobile-phase-list"></ul>
              </div>
            </div>
          </article>

          <article class="process-map-detail">
            <div id="pipeline-phase-chip" class="phase-chip pending">Pendiente</div>
            <div id="pipeline-phase-step" class="phase-step">Paso 1/11</div>
            <h3 id="pipeline-phase-title" class="phase-title">Entrada recibida</h3>
            <p id="pipeline-phase-summary" class="phase-summary">Inicia el análisis para activar el pipeline.</p>
            <div id="pipeline-phase-action" class="phase-action">Esperando inicio del proceso.</div>

            <div class="detail-grid">
              <div class="detail-item">
                <div class="detail-label">Entrada esperada</div>
                <div id="pipeline-input" class="detail-value">Video local o enlace de YouTube.</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Salida esperada</div>
                <div id="pipeline-output" class="detail-value">Fuente validada y lista para procesar.</div>
              </div>
            </div>

            <div>
              <div class="mini-progress">
                <div id="pipeline-local-progress-bar" class="mini-progress-bar"></div>
              </div>
              <div id="pipeline-local-progress-text" class="mini-progress-text">Progreso de fase: 0%</div>
            </div>

            <p id="pipeline-warning" class="inline-note warning"></p>
            <p id="pipeline-error" class="inline-note error"></p>
          </article>
        </div>
      </section>

      <section class="workspace">
        <div class="stack">
          <form id="job-form" class="panel section-anchor" data-anchor="section-input">
            <h2 class="panel-title">1. Entrada del video</h2>
            <p class="panel-sub">Sube un archivo local o pega un enlace de YouTube para iniciar el pipeline.</p>

            <label for="video">Video local (opcional)</label>
            <input id="video" name="video" type="file" accept="video/*" />

            <label for="youtubeUrl">Enlace de YouTube (opcional)</label>
            <input id="youtubeUrl" name="youtubeUrl" type="url" placeholder="https://www.youtube.com/watch?v=..." autocomplete="off" />

            <button id="submit-btn" type="submit" style="margin-top: 12px">Analizar y proponer animaciones</button>
            <div class="caption">Debes completar al menos uno: archivo local o URL de YouTube.</div>
          </form>

          <section id="transcript-panel" class="panel section-anchor" data-anchor="section-transcript" hidden>
            <h2 class="panel-title">2. Resumen de transcripción</h2>
            <pre id="transcript-preview" class="codebox"></pre>
          </section>

          <section id="result-panel" class="panel section-anchor" data-anchor="section-result" hidden>
            <h2 class="panel-title">Resultado final</h2>
            <p class="panel-sub">Cuando el render termine, podrás descargar y previsualizar el video.</p>
            <a id="download-link" class="download-link" target="_blank" rel="noopener" hidden>Descargar video final</a>
            <video id="result-video" controls hidden></video>
          </section>
        </div>

        <div class="stack">
          <section id="insights-panel" class="panel section-anchor" data-anchor="section-insights" hidden>
            <h2 class="panel-title">3. Propuesta inicial</h2>
            <p class="panel-sub">La IA detecta momentos clave y propone animaciones en lenguaje simple.</p>
            <div id="insights-list" class="insights-list" style="margin-top: 10px"></div>
          </section>

          <section id="ai-panel" class="panel section-anchor" data-anchor="section-review" hidden>
            <h2 class="panel-title">4. Ajustar y generar</h2>
            <p class="panel-sub">Selecciona, edita o añade animaciones antes del render final.</p>

            <div class="inline-actions" style="margin-top: 10px">
              <button id="add-overlay-btn" type="button" class="ghost">Añadir animación</button>
            </div>

            <div id="visual-editor" class="visual-editor"></div>

            <button id="apply-visual-btn" type="button" style="margin-top: 10px">Aplicar cambios visuales</button>
            <div class="caption">Puedes ajustar mensaje, tiempo, estilo, energía y efectos de cada animación.</div>

            <div id="chat-log" class="chat-log"></div>

            <label for="refine-input">Ajuste con IA</label>
            <textarea id="refine-input" placeholder="Ejemplo: acorta el CTA final y añade más energía en la entrada"></textarea>

            <div id="section-render" class="actions-row section-anchor" data-anchor="section-render" style="margin-top: 10px">
              <button id="refine-btn" type="button">Aplicar ajuste con IA</button>
              <button id="render-btn" type="button" class="secondary">Generar video final</button>
            </div>
          </section>
        </div>
      </section>
    </main>

    <script src="/app.js" type="module"></script>
  </body>
</html>
